input {
#  elasticsearch {
#    hosts => ["http://elasticsearch:9200"]
#    index => "person"
#    user => "elastic"
#    password => "changeme"
#    query => '{ "query": { "match": { "address.city": "Cergy" } }, "sort": [ "_doc" ] }'
#    docinfo => true
#  }
}
filter {
  elasticsearch {
    hosts => ["https://9294b959a68c4e64b8a51f1b88105ab9.europe-west1.gcp.cloud.es.io:9243"]
    user => "bano"
    password => "banobano"
    query_template => "/usr/share/logstash/config/search-by-geo.json"
    index => "bano-*"
    fields => {
      "address" => "[address_new]"
      "location" => "[address][location]"
    }
    remove_field => ["headers", "host", "@version", "@timestamp"]
  }
  mutate {
    rename => {
      "[address_new][number]" => "[address][number]"
      "[address_new][street_name]" => "[address][street_name]"
      "[address_new][zipcode]" => "[address][zipcode]"
      "[address_new][city]" => "[address][city]"
    }
    remove_field => ["address_new"]    
  }
}
output {
#  stdout { codec => rubydebug }
  elasticsearch {
    manage_template => false
    hosts => ["http://elasticsearch:9200"]
    user => "elastic"
    password => "changeme"
    index => "%{[@metadata][_index]}-new"
    document_id => "%{[@metadata][_id]}"
  }
}
